<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puppy Litter Tracker</title>
  <link rel="stylesheet" href="logifront/styles.css" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <img src="logifront/assets/golden.svg" alt="Puppilog" />
      <div class="title">Puppy Litter Tracker</div>
    </div>
    <div class="actions">
      <button id="back-to-list" class="button secondary" style="display:none">‚Üê All Litters</button>
      <button id="edit-litter" class="button secondary" style="display:none">Edit Litter</button>
      <button id="start-new" class="button">Start New Litter</button>
      <button id="reset-session" class="button secondary" title="Clears in-memory session only">Reset</button>
    </div>
  </header>

  <div class="container">
    <!-- Entry View: Litters List -->
    <section class="card" id="litters-card">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <h2>Litters</h2>
        <button id="start-new-2" class="button">Start New Litter</button>
      </div>
      <div class="list" id="litters-list">
        <div class="empty">No litters yet. Click "Start New Litter" to begin.</div>
      </div>
    </section>

    <!-- Litter-specific Dashboard -->
    <div id="dashboard" style="display:none">
      <div class="grid">
        <section class="card" id="parents-card">
          <h2>Parents</h2>
          <div id="parents-content" class="empty">No litter selected.</div>
        </section>

        <section class="card" id="pregnancy-card">
          <h2>Pregnancy</h2>
          <div class="kpis">
            <div class="kpi"><div class="label">Pregnancy Start</div><div class="value" id="kpi-start">‚Äî</div></div>
            <div class="kpi"><div class="label">Expected Due</div><div class="value" id="kpi-due">‚Äî</div></div>
            <div class="kpi"><div class="label">Expected #</div><div class="value" id="kpi-expected">‚Äî</div></div>
            <div class="kpi"><div class="label">Water Broke</div><div class="value" id="kpi-water">‚Äî</div></div>
          </div>
          <hr class="sep" />
          <div class="row">
            <div class="input">
              <label for="waterTime">Record Water Broke Time</label>
              <input type="datetime-local" id="waterTime" />
            </div>
            <div class="input" style="align-self:flex-end; max-width:160px">
              <label>&nbsp;</label>
              <button class="button" id="save-water">Save</button>
            </div>
          </div>
          <div id="pregnancy-note" class="small muted" style="margin-top:6px"></div>
        </section>

        <section class="card" id="puppies-card" style="grid-column:1 / -1">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <h2>Puppies</h2>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button class="button secondary" id="open-camera" title="Open camera">üì∑ Camera</button>
              <button class="button" id="add-puppy">Add Puppy</button>
            </div>
          </div>
          <div class="list" id="puppies-list"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- Modal: Puppy Details -->
  <div class="modal-backdrop" id="puppy-detail-modal" style="display:none">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <div style="display:flex; align-items:center; gap:10px">
          <div class="logo-xl avatar" id="pd-avatar"></div>
          <div>
            <div style="font-weight:800" id="pd-title">Puppy Details</div>
            <div class="small muted" id="pd-sub">After recording birth time, please add gender and daily weights (recommended).</div>
          </div>
        </div>
      </header>
      <main>
        <div class="row">
          <div class="input">
            <label for="pdBirth">Birth Time</label>
            <input type="datetime-local" id="pdBirth" />
          </div>
          <div class="input">
            <label for="pdName">Name</label>
            <input type="text" id="pdName" placeholder="Defaults to selected color" />
          </div>
          <div class="input" style="max-width:220px">
            <label for="pdColor">Collar Color</label>
            <select id="pdColor">
              <option value="#22c55e">Green</option>
              <option value="#2563eb">Blue</option>
              <option value="#60a5fa">Light Blue</option>
              <option value="#ef4444">Red</option>
              <option value="#f59e0b">Yellow</option>
              <option value="#a78bfa">Purple</option>
              <option value="#fb923c">Orange</option>
              <option value="#ec4899">Pink</option>
            </select>
          </div>
          <div class="input" style="max-width:200px">
            <label for="pdGender">Gender</label>
            <select id="pdGender">
              <option value="">Unknown</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="input" style="max-width:220px">
            <label for="pdTodayWeight">Today's Weight (kg)</label>
            <input type="number" step="0.01" min="0" id="pdTodayWeight" placeholder="e.g. 0.45" />
          </div>
          <div class="input" style="flex:1 1 100%">
            <label for="pdNotes">Notes</label>
            <input type="text" id="pdNotes" placeholder="Notes" />
          </div>
        </div>
        <hr class="sep" />
        <div id="pdWeightSection">
          <div class="small muted" id="pd-hint" style="margin-bottom:8px">Daily weight log (42 days from birth). Edit as needed.</div>
          <div style="margin-bottom:8px; display:flex; gap:8px; flex-wrap:wrap">
            <button class="button secondary tiny" id="pd-log-toggle" type="button">Show Weight Log</button>
            <button class="button secondary tiny" id="pd-gallery-toggle" type="button">Open Gallery</button>
          </div>
          <div id="pdWeightLog" class="list"></div>
        </div>
        <hr class="sep" />
        <section class="card" id="pdGallerySection" style="display:none">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap">
            <h3 style="margin:0">Puppy Gallery</h3>
            <button class="button secondary tiny" id="pd-gallery-close" type="button">Close Gallery</button>
          </div>
          <div id="pdGallery" class="gallery"></div>
        </section>
      </main>
      <footer>
        <div class="left">
          <button class="button secondary" id="pd-cancel">Close</button>
        </div>
        <div class="right">
          <button class="button" id="pd-save">Save Changes</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Modal: Edit Weight -->
  <div class="modal-backdrop" id="weight-edit-modal" style="display:none">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <button class="button secondary icon" id="wprev" title="Previous day" aria-label="Previous day">‚Üê</button>
        <div style="flex:1; text-align:center">
          <div style="font-weight:800" id="w-title">Edit Weight</div>
          <div class="small muted" id="w-sub">‚Äî</div>
        </div>
        <button class="button secondary icon" id="wnext" title="Next day" aria-label="Next day">‚Üí</button>
      </header>
      <main>
        <div class="row" style="justify-content:center">
          <div class="input" style="max-width:260px; width:100%">
            <label for="w-input">Weight (kg) for <span id="w-date-label">‚Äî</span></label>
            <input type="number" step="0.01" min="0" id="w-input" placeholder="e.g. 0.45" />
          </div>
        </div>
      </main>
      <footer>
        <div class="left">
          <button class="button secondary" id="w-cancel">Cancel</button>
        </div>
        <div class="right">
          <button class="button" id="w-save">Save</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Modal: New Litter Questionnaire -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <div style="display:flex; align-items:center; gap:10px">
          <img class="logo-xl" src="logifront/assets/golden.svg" alt="Logo" />
          <div>
            <div id="modal-title" style="font-weight:800">Create New Litter</div>
            <div id="modal-subtitle" class="small muted">Answer a few quick questions</div>
          </div>
        </div>
        <div class="step-indicator" id="steps"></div>
      </header>
      <main>
        <div id="step-content"></div>
      </main>
      <footer>
        <div class="left">
          <button class="button secondary" id="cancel-modal">Cancel</button>
        </div>
        <div class="right">
          <button class="button secondary" id="prev-step">Back</button>
          <button class="button secondary" id="skip-step" title="Skip this step and fill it later">Skip</button>
          <button class="button" id="next-step">Next</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Modal: Add Puppy -->
  <div class="modal-backdrop" id="puppy-modal" style="display:none">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <div style="display:flex; align-items:center; gap:10px">
          <img class="logo-xl" src="logifront/assets/golden.svg" alt="Logo" />
          <div>
            <div style="font-weight:800">Add Puppy</div>
            <div class="small muted">All questions are optional and can be added later. Only collar color is required.</div>
          </div>
        </div>
      </header>
      <main>
        <div class="row">
          <div class="input">
            <label for="puppyBirth2">Birth Time</label>
            <input type="datetime-local" id="puppyBirth2" />
          </div>
          <div class="input">
            <label for="puppyName2">Name</label>
            <input type="text" id="puppyName2" placeholder="Defaults to selected color" />
          </div>
          <div class="input">
            <label for="puppyNotes2">Notes</label>
            <input type="text" id="puppyNotes2" placeholder="Weight, position‚Ä¶" />
          </div>
          <div class="input" style="max-width:220px">
            <label for="puppyColor">Collar Color (required)</label>
            <select id="puppyColor">
              <option value="#22c55e">Green</option>
              <option value="#2563eb">Blue</option>
              <option value="#60a5fa">Light Blue</option>
              <option value="#ef4444">Red</option>
              <option value="#f59e0b">Yellow</option>
              <option value="#a78bfa">Purple</option>
              <option value="#fb923c">Orange</option>
              <option value="#ec4899">Pink</option>
            </select>
          </div>
        </div>
      </main>
      <footer>
        <div class="left">
          <button class="button secondary" id="puppy-cancel">Cancel</button>
        </div>
        <div class="right">
          <button class="button" id="puppy-save">Save Puppy</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Modal: Camera Capture -->
  <div class="modal-backdrop" id="camera-modal" style="display:none">
    <div class="modal" role="dialog" aria-modal="true" style="width:min(900px, 96vw);">
      <header>
        <div style="font-weight:800">Camera</div>
        <button class="button secondary" id="cam-close">Close</button>
      </header>
      <main>
        <div class="row" style="justify-content:center">
          <div style="width:100%; max-width:720px; display:flex; flex-direction:column; gap:10px; align-items:center">
            <video id="cam-video" autoplay playsinline style="width:100%; max-height:60vh; background:#000; border-radius:12px"></video>
            <img id="cam-preview" alt="Preview" style="display:none; width:100%; max-height:60vh; object-fit:contain; border-radius:12px; background:#000" />
            <canvas id="cam-canvas" style="display:none"></canvas>
            <div id="cam-controls" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center">
              <button class="button" id="cam-capture">Capture</button>
              <button class="button secondary" id="cam-retake" style="display:none">Retake</button>
            </div>
            <div id="cam-meta" style="display:none; width:100%">
              <div class="input">
                <label for="cam-time">Taken at</label>
                <input type="datetime-local" id="cam-time" />
              </div>
              <div class="input">
                <label>Puppies in photo (select one or more)</label>
                <div id="cam-puppies" class="list"></div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <footer>
        <div class="left">
          <button class="button secondary" id="cam-cancel">Cancel</button>
        </div>
        <div class="right">
          <button class="button" id="cam-save" disabled>Save Photo</button>
        </div>
      </footer>
    </div>
  </div>

  <script src="logifront/service.js"></script>
  <script src="logifront/app.js"></script>
</body>
</html>